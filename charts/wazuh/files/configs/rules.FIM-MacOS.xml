<!-- macOS FIM Rules - Optimized for Performance -->
<!-- File 1 of 3: FIM monitoring only -->

<group name="macos,syscheck,fim">

    <!-- ============================================== -->
    <!-- SYSTEM BINARIES                               -->
    <!-- ============================================== -->

    <rule id="600001" level="12">
        <if_sid>550</if_sid>
        <field name="file" type="pcre2">^/(usr/)?(s?bin|usr/bin)</field>
        <description>macOS FIM: System binary modified</description>
        <group>syscheck,file_integrity,pci_dss_11.5,nist_800_53_SI.7</group>
    </rule>

    <rule id="600002" level="0">
        <if_sid>600001</if_sid>
        <field name="uname" type="pcre2">^(_installer|root|brew|port|fink)$</field>
        <description>macOS FIM: Authorized binary modification</description>
    </rule>

    <rule id="600003" level="14">
        <if_sid>600001</if_sid>
        <field name="changed_attributes" type="pcre2">(permission|uid|gid)</field>
        <description>macOS FIM: Binary permission change - privilege escalation risk</description>
        <group>syscheck,file_integrity,privilege_escalation,pci_dss_11.5,nist_800_53_SI.7</group>
    </rule>

    <rule id="600004" level="15">
        <if_sid>600001</if_sid>
        <field name="changed_attributes" type="pcre2">(size|md5|sha1|sha256)</field>
        <description>macOS FIM: Binary content modified - potential malware</description>
        <group>syscheck,file_integrity,malware,pci_dss_11.5,nist_800_53_SI.7</group>
    </rule>

    <!-- ============================================== -->
    <!-- CONFIGURATION FILES                           -->
    <!-- ============================================== -->

    <rule id="600010" level="10">
        <if_sid>550</if_sid>
        <field name="file" type="pcre2">^/(private/)?etc/</field>
        <description>macOS FIM: System configuration modified</description>
        <group>syscheck,file_integrity,pci_dss_11.5,nist_800_53_SI.7</group>
    </rule>

    <rule id="600011" level="14">
        <if_sid>600010</if_sid>
        <field name="file" type="pcre2">(sudoers|ssh/sshd_config|pam\.d|authorization)$</field>
        <description>macOS FIM: Critical security configuration modified</description>
        <group>syscheck,file_integrity,privilege_escalation,pci_dss_11.5,nist_800_53_SI.7</group>
    </rule>

    <!-- ============================================== -->
    <!-- LAUNCH DAEMONS/AGENTS                         -->
    <!-- ============================================== -->

    <rule id="600020" level="12">
        <if_sid>550</if_sid>
        <field name="file" type="pcre2">/Library/Launch(Daemons|Agents)|/System/Library/Launch(Daemons|Agents)</field>
        <description>macOS FIM: Launch daemon/agent modified - persistence mechanism</description>
        <group>syscheck,file_integrity,persistence,pci_dss_11.5,nist_800_53_SI.7</group>
    </rule>

    <rule id="600021" level="14">
        <if_sid>554</if_sid>
        <field name="file" type="pcre2">/Library/Launch(Daemons|Agents)</field>
        <description>macOS FIM: New launch daemon/agent added - potential persistence</description>
        <group>syscheck,file_integrity,persistence,pci_dss_11.5,nist_800_53_SI.7</group>
    </rule>

    <!-- ============================================== -->
    <!-- USER PROFILES AND CRON                        -->
    <!-- ============================================== -->

    <rule id="600030" level="10">
        <if_sid>550</if_sid>
        <field name="file" type="pcre2">\.(bash_profile|bashrc|zshrc|profile)$</field>
        <description>macOS FIM: User shell profile modified - potential persistence</description>
        <group>syscheck,file_integrity,persistence,pci_dss_11.5,nist_800_53_SI.7</group>
    </rule>

    <rule id="600040" level="10">
        <if_sid>550</if_sid>
        <field name="file" type="pcre2">(^/(private/)?var/at/|/usr/lib/cron|/etc/crontab)</field>
        <description>macOS FIM: Cron/at job modified - potential persistence</description>
        <group>syscheck,file_integrity,persistence,pci_dss_11.5,nist_800_53_SI.7</group>
    </rule>

</group>