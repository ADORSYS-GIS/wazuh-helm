<!--
  Application Blacklist Rules
  CONSOLIDATED VERSION - Reduced memory footprint

  Architecture:
  - Category definitions with shared regex patterns
  - Detection rules grouped by source type
  - Avoid duplicate pattern matching across vectors

  Rule IDs: 750000-750099
-->

<group name="app_blacklist,software_inventory,">

  <!-- ================================================== -->
  <!-- CATEGORY: CRYPTOCURRENCY MINERS (CRITICAL - Level 14) -->
  <!-- Pattern: xmrig|nicehash|minergate|claymore|phoenixminer|nbminer|trex|gminer|lolminer|ethminer|cgminer|bfgminer|cpuminer|cryptotab|minerd|xmr-stak -->
  <!-- ================================================== -->

  <!-- Via software inventory -->
  <rule id="750040" level="14">
    <if_sid>221</if_sid>
    <field name="data.program.name" type="pcre2">(?i)xmrig|nicehash|minergate|claymore|phoenixminer|nbminer|t-?rex|gminer|lolminer|ethminer|cgminer|bfgminer|cpuminer|cryptotab|minerd|xmr-?stak</field>
    <description>CRITICAL: Cryptocurrency miner installed - $(data.program.name)</description>
    <mitre>
      <id>T1496</id>
    </mitre>
    <group>unauthorized_software,cryptominer,malware,pci_dss_10.6.1,</group>
  </rule>

  <!-- Via auditd execve -->
  <rule id="750041" level="14">
    <if_group>audit</if_group>
    <field name="audit.execve.a0" type="pcre2">(?i)xmrig|nicehash|minergate|claymore|phoenixminer|nbminer|t-?rex|gminer|lolminer|ethminer|cgminer|bfgminer|cpuminer|cryptotab|minerd|xmr-?stak</field>
    <description>CRITICAL: Cryptocurrency miner executed - $(audit.execve.a0)</description>
    <mitre>
      <id>T1496</id>
    </mitre>
    <group>unauthorized_software,unauthorized_process,cryptominer,</group>
  </rule>

  <!-- Via dpkg/apt -->
  <rule id="750042" level="14">
    <if_sid>2902</if_sid>
    <match type="pcre2">(?i)xmrig|minergate|cpuminer|cgminer|bfgminer|ethminer</match>
    <description>CRITICAL: Cryptocurrency miner installed via apt/dpkg</description>
    <mitre>
      <id>T1496</id>
    </mitre>
    <group>unauthorized_software,dpkg,cryptominer,</group>
  </rule>

  <!-- ================================================== -->
  <!-- CATEGORY: HACKING/PENTESTING TOOLS (CRITICAL - Level 14) -->
  <!-- ================================================== -->

  <!-- Via software inventory -->
  <rule id="750030" level="14">
    <if_sid>221</if_sid>
    <field name="data.program.name" type="pcre2">(?i)nmap|wireshark|metasploit|burpsuite|sqlmap|john|hashcat|hydra|aircrack|ettercap|cain|mimikatz|cobaltstrike|bloodhound|responder|impacket|crackmapexec|lazagne|rubeus|kali</field>
    <description>CRITICAL: Hacking/pentesting tool installed - $(data.program.name)</description>
    <mitre>
      <id>T1588.002</id>
    </mitre>
    <group>unauthorized_software,hacking_tool,pci_dss_10.6.1,gdpr_IV_35.7.d,</group>
  </rule>

  <!-- Via auditd execve -->
  <rule id="750031" level="14">
    <if_group>audit</if_group>
    <field name="audit.execve.a0" type="pcre2">(?i)^nmap$|^wireshark$|^tshark$|^metasploit$|^msfconsole$|^msfvenom$|^burpsuite$|^sqlmap$|^john$|^hashcat$|^hydra$|^aircrack|^airmon|^ettercap$|^mimikatz$|^cobaltstrike$|^bloodhound$|^responder$|^crackmapexec$|^lazagne$|^rubeus$|^powersploit$|^empire$</field>
    <description>CRITICAL: Hacking/pentesting tool executed - $(audit.execve.a0)</description>
    <mitre>
      <id>T1588.002</id>
    </mitre>
    <group>unauthorized_software,unauthorized_process,hacking_tool,</group>
  </rule>

  <!-- Via dpkg/apt -->
  <rule id="750032" level="14">
    <if_sid>2902</if_sid>
    <match type="pcre2">(?i)nmap|wireshark|tshark|metasploit|sqlmap|john|hashcat|hydra|aircrack|ettercap|nikto|gobuster|dirb|burpsuite|zaproxy</match>
    <description>CRITICAL: Hacking/network tool installed via apt/dpkg</description>
    <mitre>
      <id>T1588.002</id>
    </mitre>
    <group>unauthorized_software,dpkg,hacking_tool,</group>
  </rule>

  <!-- ================================================== -->
  <!-- CATEGORY: REMOTE ACCESS TOOLS (HIGH - Level 12)    -->
  <!-- ================================================== -->

  <!-- Via software inventory -->
  <rule id="750010" level="12">
    <if_sid>221</if_sid>
    <field name="data.program.name" type="pcre2">(?i)teamviewer|anydesk|ammyy|remotepc|supremo|rustdesk|parsec|splashtop|logmein|gotomypc|screenconnect|connectwise|bomgar|dameware|radmin|ultraviewer|atera|meshcentral</field>
    <description>UNAUTHORIZED: Remote access tool installed - $(data.program.name)</description>
    <mitre>
      <id>T1219</id>
    </mitre>
    <group>unauthorized_software,remote_access,pci_dss_10.6.1,gdpr_IV_35.7.d,hipaa_164.312.b,</group>
  </rule>

  <!-- Via auditd execve -->
  <rule id="750011" level="12">
    <if_group>audit</if_group>
    <field name="audit.execve.a0" type="pcre2">(?i)teamviewer|anydesk|ammyy|remotepc|supremo|rustdesk|parsec|splashtop|logmein|gotomypc|screenconnect|connectwise|bomgar|dameware|radmin|ultraviewer|atera|meshcentral|vnc|tightvnc|ultravnc|realvnc</field>
    <description>ALERT: Remote access tool executed - $(audit.execve.a0)</description>
    <mitre>
      <id>T1219</id>
    </mitre>
    <group>unauthorized_software,unauthorized_process,remote_access,</group>
  </rule>

  <!-- Via dpkg/apt -->
  <rule id="750012" level="12">
    <if_sid>2902</if_sid>
    <match type="pcre2">(?i)anydesk|teamviewer|rustdesk|remmina|xrdp|x11vnc|tigervnc|tightvnc|realvnc</match>
    <description>ALERT: Remote access tool installed via apt/dpkg</description>
    <mitre>
      <id>T1219</id>
    </mitre>
    <group>unauthorized_software,dpkg,remote_access,</group>
  </rule>

  <!-- ================================================== -->
  <!-- CATEGORY: P2P/TORRENT CLIENTS (MEDIUM - Level 10)  -->
  <!-- ================================================== -->

  <!-- Via software inventory -->
  <rule id="750020" level="10">
    <if_sid>221</if_sid>
    <field name="data.program.name" type="pcre2">(?i)utorrent|bittorrent|qbittorrent|deluge|transmission|vuze|limewire|frostwire|emule|kazaa|ares|tixati|biglybt|webtorrent</field>
    <description>UNAUTHORIZED: P2P/Torrent client installed - $(data.program.name)</description>
    <mitre>
      <id>T1048</id>
    </mitre>
    <group>unauthorized_software,p2p,policy_violation,</group>
  </rule>

  <!-- Via auditd execve -->
  <rule id="750021" level="10">
    <if_group>audit</if_group>
    <field name="audit.execve.a0" type="pcre2">(?i)utorrent|bittorrent|qbittorrent|deluge|transmission|vuze|limewire|frostwire|emule|kazaa|ares|tixati|biglybt|webtorrent|aria2</field>
    <description>ALERT: P2P/Torrent client executed - $(audit.execve.a0)</description>
    <mitre>
      <id>T1048</id>
    </mitre>
    <group>unauthorized_software,unauthorized_process,p2p,</group>
  </rule>

  <!-- Via dpkg/apt -->
  <rule id="750022" level="10">
    <if_sid>2902</if_sid>
    <match type="pcre2">(?i)transmission|deluge|qbittorrent|rtorrent|aria2</match>
    <description>ALERT: P2P/Torrent client installed via apt/dpkg</description>
    <mitre>
      <id>T1048</id>
    </mitre>
    <group>unauthorized_software,dpkg,p2p,</group>
  </rule>

  <!-- ================================================== -->
  <!-- CATEGORY: VPN/PROXY SOFTWARE (MEDIUM - Level 8)    -->
  <!-- ================================================== -->

  <!-- Via software inventory -->
  <rule id="750050" level="8">
    <if_sid>221</if_sid>
    <field name="data.program.name" type="pcre2">(?i)nordvpn|expressvpn|surfshark|protonvpn|cyberghost|privateinternetaccess|tunnelbear|windscribe|hotspotshield|hola|psiphon|ultrasurf|torbrowser|torproject</field>
    <description>UNAUTHORIZED: VPN/Proxy software installed - $(data.program.name)</description>
    <mitre>
      <id>T1090</id>
    </mitre>
    <group>unauthorized_software,vpn,policy_violation,</group>
  </rule>

  <!-- Via auditd execve -->
  <rule id="750051" level="8">
    <if_group>audit</if_group>
    <field name="audit.execve.a0" type="pcre2">(?i)nordvpn|expressvpn|surfshark|protonvpn|cyberghost|pia|tunnelbear|windscribe|hotspotshield|hola|psiphon|ultrasurf|^tor$|torbrowser|openvpn|wireguard</field>
    <description>ALERT: VPN/Proxy tool executed - $(audit.execve.a0)</description>
    <mitre>
      <id>T1090</id>
    </mitre>
    <group>unauthorized_software,unauthorized_process,vpn,</group>
  </rule>

  <!-- ================================================== -->
  <!-- CATEGORY: GAMING SOFTWARE (LOW - Level 6)          -->
  <!-- ================================================== -->

  <!-- Via software inventory -->
  <rule id="750060" level="6">
    <if_sid>221</if_sid>
    <field name="data.program.name" type="pcre2">(?i)^steam$|^steam\.exe|epicgames|^origin$|battlenet|battle\.net|riotclient|riot games|^gog$|uplay|ubisoft|xbox|playnite</field>
    <description>Policy Violation: Gaming software installed - $(data.program.name)</description>
    <group>unauthorized_software,gaming,policy_violation,</group>
  </rule>

  <!-- Via auditd execve -->
  <rule id="750061" level="6">
    <if_group>audit</if_group>
    <field name="audit.execve.a0" type="pcre2">(?i)^steam$|steamwebhelper|epicgameslauncher|^origin$|battlenet|battle\.net|riotclient|leagueclient|valorant|^gog$|uplay|ubisoft|xbox|playnite</field>
    <description>Policy Violation: Gaming software executed - $(audit.execve.a0)</description>
    <group>unauthorized_software,unauthorized_process,gaming,</group>
  </rule>

  <!-- ================================================== -->
  <!-- WINDOWS SPECIFIC DETECTION                         -->
  <!-- ================================================== -->

  <!-- Windows installer events (Event ID 11707 - Installation success) -->
  <rule id="750080" level="0">
    <if_sid>60009</if_sid>
    <field name="win.system.eventID">^11707$</field>
    <description>Windows Installer: Program installed successfully</description>
    <group>software_installed,windows,</group>
  </rule>

  <!-- Windows installed program - blacklisted (consolidated) -->
  <rule id="750081" level="12">
    <if_sid>750080</if_sid>
    <field name="win.eventdata.data" type="pcre2">(?i)teamviewer|anydesk|ammyy|remotepc|supremo|rustdesk|parsec|splashtop|logmein|screenconnect|radmin|ultraviewer|utorrent|bittorrent|qbittorrent|deluge|transmission|vuze|nmap|wireshark|metasploit|burpsuite|hashcat|hydra|mimikatz|xmrig|nicehash|minergate|phoenixminer|nordvpn|expressvpn|surfshark|protonvpn|cyberghost|tunnelbear|steam|epicgames|origin|battlenet|riotclient|uplay</field>
    <description>UNAUTHORIZED: Blacklisted Windows program installed via MSI</description>
    <group>unauthorized_software,windows,</group>
  </rule>

  <!-- ================================================== -->
  <!-- SOFTWARE REMOVAL TRACKING                          -->
  <!-- ================================================== -->

  <rule id="750090" level="3">
    <if_sid>222</if_sid>
    <description>Software removed: $(data.program.name)</description>
    <group>software_removed,</group>
  </rule>

  <!-- Track removal of security software (suspicious) -->
  <rule id="750091" level="10">
    <if_sid>222</if_sid>
    <field name="data.program.name" type="pcre2">(?i)wazuh|ossec|defender|antivirus|endpoint|security|firewall|crowdstrike|sentinel|carbon</field>
    <description>WARNING: Security software removed - $(data.program.name)</description>
    <mitre>
      <id>T1562.001</id>
    </mitre>
    <group>security_software_removed,defense_evasion,</group>
  </rule>

</group>
