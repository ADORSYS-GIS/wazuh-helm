<agent_config os="Windows">
  <!-- ===================== -->
  <!-- WINDOWS CONFIGURATION -->
  <!-- ===================== -->

  <!-- System Inventory with hotfixes -->
  <wodle name="syscollector">
    <disabled>no</disabled>
    <interval>1h</interval>
    <scan_on_start>yes</scan_on_start>
    <synchronize>yes</synchronize>
    <hardware>yes</hardware>
    <os>yes</os>
    <network>yes</network>
    <packages>yes</packages>
    <ports all="no">yes</ports>
    <processes>yes</processes>
    <hotfixes>yes</hotfixes>
  </wodle>

  <!-- File Integrity Monitoring -->
  <syscheck>
    <disabled>no</disabled>
    <frequency>43200</frequency>
    <scan_on_start>yes</scan_on_start>
    <alert_new_files>yes</alert_new_files>
    <auto_ignore frequency="10" timeframe="3600">no</auto_ignore>

    <!-- Windows System directories -->
    <directories realtime="yes" check_all="yes">C:\Windows\System32\drivers\etc</directories>
    <directories realtime="yes" check_all="yes">C:\Windows\System32\wbem</directories>
    <directories realtime="yes" check_all="yes">C:\Windows\System32\WindowsPowerShell</directories>
    <directories check_all="yes">C:\Windows\System32\config</directories>

    <!-- Startup locations -->
    <directories realtime="yes" check_all="yes">C:\Users\*\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</directories>
    <directories realtime="yes" check_all="yes">C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup</directories>

    <!-- Scheduled Tasks -->
    <directories realtime="yes" check_all="yes">C:\Windows\System32\Tasks</directories>

    <!-- Windows Registry monitoring -->
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Classes\batfile</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Classes\cmdfile</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Classes\comfile</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Classes\exefile</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Classes\piffile</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Classes\AllFilesystemObjects</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Classes\Directory</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Classes\Folder</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Classes\Protocols</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Policies</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Security</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\KnownDLLs</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SecurePipeServers\winreg</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnceEx</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\URL</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Windows</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Microsoft\Active Setup\Installed Components</windows_registry>

    <!-- Ignores -->
    <ignore type="sregex">.log$|.tmp$</ignore>
    <ignore>C:\Windows\System32\config\systemprofile\AppData\Local\Microsoft\WindowsApps</ignore>
    <ignore>C:\Program Files\WindowsApps</ignore>
    <ignore type="sregex">WindowsApps</ignore>

    <!-- Windows scheduled tasks (frequent updates, low security value) -->
    <ignore type="sregex">c:\\windows\\system32\\tasks\\microsoft\\windows\\flighting</ignore>
    <ignore type="sregex">c:\\windows\\system32\\tasks\\microsoft\\windows\\updateorchestrator</ignore>

    <!-- WMI repository (frequent changes, low security value) -->
    <ignore type="sregex">c:\\windows\\system32\\wbem\\repository</ignore>

    <!-- Registry ignores for noisy keys -->
    <registry_ignore type="sregex">HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\bam\\State</registry_ignore>
    <registry_ignore type="sregex">HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\W32Time\\SecureTimeLimits</registry_ignore>
    <registry_ignore type="sregex">HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\Tcpip6?\\Parameters\\Interfaces</registry_ignore>
    <registry_ignore type="sregex">HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\NcbService\\NCBKapiNlmCache</registry_ignore>

    <skip_nfs>yes</skip_nfs>
    <max_eps>100</max_eps>
  </syscheck>

  <!-- Windows Event Channels -->
  <localfile>
    <location>Security</location>
    <log_format>eventchannel</log_format>
    <query>Event[System[(Level=1 or Level=2 or Level=3 or Level=4 or Level=0)]]</query>
  </localfile>

  <localfile>
    <location>System</location>
    <log_format>eventchannel</log_format>
    <query>Event[System[(Level=1 or Level=2 or Level=3)]]</query>
  </localfile>

  <localfile>
    <location>Application</location>
    <log_format>eventchannel</log_format>
    <query>Event[System[(Level=1 or Level=2 or Level=3)]]</query>
  </localfile>

  <!-- Windows Installer / MSI events for app install detection -->
  <localfile>
    <location>Application</location>
    <log_format>eventchannel</log_format>
    <query>Event[System[Provider[@Name='MsiInstaller']]]</query>
  </localfile>

  <!-- AppLocker events (if enabled) -->
  <localfile>
    <location>Microsoft-Windows-AppLocker/EXE and DLL</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <localfile>
    <location>Microsoft-Windows-AppLocker/MSI and Script</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <localfile>
    <location>Microsoft-Windows-AppLocker/Packaged app-Deployment</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <localfile>
    <location>Microsoft-Windows-AppLocker/Packaged app-Execution</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <!-- Windows Defender logs -->
  <localfile>
    <location>Microsoft-Windows-Windows Defender/Operational</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <!-- PowerShell logging -->
  <localfile>
    <location>Microsoft-Windows-PowerShell/Operational</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <!-- Windows Firewall -->
  <localfile>
    <location>Microsoft-Windows-Windows Firewall With Advanced Security/Firewall</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <!-- Sysmon (if installed) -->
  <localfile>
    <location>Microsoft-Windows-Sysmon/Operational</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <!-- Task Scheduler -->
  <localfile>
    <location>Microsoft-Windows-TaskScheduler/Operational</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <!-- Remote Desktop -->
  <localfile>
    <location>Microsoft-Windows-TerminalServices-RemoteConnectionManager/Operational</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <localfile>
    <location>Microsoft-Windows-TerminalServices-LocalSessionManager/Operational</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <!-- DNS Client Events -->
  <localfile>
    <location>Microsoft-Windows-DNS-Client/Operational</location>
    <log_format>eventchannel</log_format>
  </localfile>
</agent_config>
