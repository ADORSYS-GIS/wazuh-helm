<agent_config>
  <!-- Docker monitoring configuration -->
  <!-- This configuration is applied to agents in the 'docker' group -->
  <!-- Compatible with Linux and macOS Docker Desktop -->

  <wodle name="docker-listener">
    <interval>10m</interval>
    <attempts>5</attempts>
    <run_on_start>yes</run_on_start>
    <disabled>no</disabled>
  </wodle>

  <!-- Command to monitor Docker containers -->
  <wodle name="command">
    <disabled>no</disabled>
    <tag>docker-containers</tag>
    <command>docker ps -a --format "{{.ID}}|{{.Image}}|{{.Names}}|{{.Status}}|{{.Ports}}"</command>
    <interval>5m</interval>
    <ignore_output>no</ignore_output>
    <run_on_start>yes</run_on_start>
    <timeout>30</timeout>
  </wodle>

  <!-- Monitor Docker stats -->
  <wodle name="command">
    <disabled>no</disabled>
    <tag>docker-stats</tag>
    <command>docker stats --no-stream --format "{{.Container}}|{{.CPUPerc}}|{{.MemUsage}}|{{.NetIO}}|{{.BlockIO}}"</command>
    <interval>10m</interval>
    <ignore_output>no</ignore_output>
    <run_on_start>yes</run_on_start>
    <timeout>30</timeout>
  </wodle>

  <!-- Monitor Docker events (last 100 events) -->
  <wodle name="command">
    <disabled>no</disabled>
    <tag>docker-events</tag>
    <command>docker events --since 5m --until 0s --format '{{json .}}'</command>
    <interval>5m</interval>
    <ignore_output>no</ignore_output>
    <run_on_start>yes</run_on_start>
    <timeout>30</timeout>
  </wodle>

  <!-- Collect logs from all running containers -->
  <wodle name="command">
    <disabled>no</disabled>
    <tag>docker-logs</tag>
    <command>for container in $(docker ps -q); do echo "=== Container: $(docker inspect --format='{{.Name}}' $container) ==="; docker logs --tail=50 --since=5m $container 2>&1; done</command>
    <interval>5m</interval>
    <ignore_output>no</ignore_output>
    <run_on_start>yes</run_on_start>
    <timeout>60</timeout>
  </wodle>

  <!-- Monitor Docker images -->
  <wodle name="command">
    <disabled>no</disabled>
    <tag>docker-images</tag>
    <command>docker images --format "{{.Repository}}:{{.Tag}}|{{.ID}}|{{.Size}}|{{.CreatedAt}}"</command>
    <interval>1h</interval>
    <ignore_output>no</ignore_output>
    <run_on_start>yes</run_on_start>
    <timeout>30</timeout>
  </wodle>

</agent_config>
