# =============================================================================
# MULTI-TENANCY CONFIGURATION
# =============================================================================
indexer:
  multiTenancy:
    enabled: true

    # -------------------------------------------------------------------------
    # TENANT DEFINITIONS
    # -------------------------------------------------------------------------
    tenants:
      cm_tenant:
        description: "Tenant for Cameroon team"
      de_tenant:
        description: "Tenant for Germany team"
      ext_tenant:
        description: "Tenant for External actors (auditors)"

    # -------------------------------------------------------------------------
    # INTERNAL USERS (OpenSearch Native Authentication)
    # -------------------------------------------------------------------------
    internalUsers:
      cm_admin:
        enabled: true
        password: "CM_Admin_Ch@ng3M3!"
        backendRoles:
          - "wazuh_cm_admin"
        description: "Cameroon country administrator"

      cm_user:
        enabled: true
        password: "CM_User_Ch@ng3M3!"
        backendRoles:
          - "wazuh_cm_user"
        description: "Cameroon read-only user"

      de_admin:
        enabled: true
        password: "DE_Admin_Ch@ng3M3!"
        backendRoles:
          - "wazuh_de_admin"
        description: "Germany country administrator"

      de_user:
        enabled: true
        password: "DE_User_Ch@ng3M3!"
        backendRoles:
          - "wazuh_de_user"
        description: "Germany read-only user"

      ext_admin:
        enabled: true
        password: "EXT_Admin_Ch@ng3M3!"
        backendRoles:
          - "wazuh_ext_admin"
        description: "External actors administrator (auditors)"

      ext_user:
        enabled: true
        password: "EXT_User_Ch@ng3M3!"
        backendRoles:
          - "wazuh_ext_user"
        description: "External read-only user"

    # -------------------------------------------------------------------------
    # AGENT GROUPS
    # -------------------------------------------------------------------------
    agentGroups:
      - name: "CM"
        description: "Cameroon agents"
      - name: "DE"
        description: "Germany agents"
      - name: "EXT"
        description: "External agents"

    # -------------------------------------------------------------------------
    # ROLE DEFINITIONS
    # -------------------------------------------------------------------------
    roles:
      wazuh_cm_admin:
        reserved: false
        cluster_permissions:
          - "cluster_monitor"
          - "cluster_composite_ops"
          - "cluster:admin/opendistro/reports/*"
          - "cluster:admin/opendistro/alerting/*"
          - "indices:admin/template/*"
          - "indices:data/read/scroll*"
        index_permissions:
          - index_patterns:
              - "wazuh-alerts-*"
              - "wazuh-archives-*"
            dls: '{"bool":{"should":[{"match":{"agent.groups":"CM"}},{"bool":{"must_not":{"exists":{"field":"agent.groups"}}}}]}}'
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - "wazuh-monitoring-*"
            dls: '{"bool":{"should":[{"match":{"group":"CM"}},{"bool":{"must_not":{"exists":{"field":"group"}}}}]}}'
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - "wazuh-statistics-*"
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - ".wazuh"
              - ".wazuh-version"
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - ".kibana*"
              - ".opensearch_dashboards*"
            allowed_actions:
              - "read"
              - "write"
              - "delete"
              - "manage"
              - "indices_all"
        tenant_permissions:
          - tenant_patterns:
              - "cm_tenant"
            allowed_actions:
              - "kibana_all_write"

      wazuh_cm_user:
        reserved: false
        cluster_permissions:
          - "cluster_monitor"
          - "cluster_composite_ops_ro"
          - "indices:data/read/scroll*"
        index_permissions:
          - index_patterns:
              - "wazuh-alerts-*"
              - "wazuh-archives-*"
            dls: '{"bool":{"should":[{"match":{"agent.groups":"CM"}},{"bool":{"must_not":{"exists":{"field":"agent.groups"}}}}]}}'
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - "wazuh-monitoring-*"
            dls: '{"bool":{"should":[{"match":{"group":"CM"}},{"bool":{"must_not":{"exists":{"field":"group"}}}}]}}'
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - "wazuh-statistics-*"
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - ".wazuh"
              - ".wazuh-version"
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - ".kibana*"
              - ".opensearch_dashboards*"
            allowed_actions:
              - "read"
              - "search"
              - "get"
        tenant_permissions:
          - tenant_patterns:
              - "cm_tenant"
            allowed_actions:
              - "kibana_all_read"

      wazuh_de_admin:
        reserved: false
        cluster_permissions:
          - "cluster_monitor"
          - "cluster_composite_ops"
          - "cluster:admin/opendistro/reports/*"
          - "cluster:admin/opendistro/alerting/*"
          - "indices:admin/template/*"
          - "indices:data/read/scroll*"
        index_permissions:
          - index_patterns:
              - "wazuh-alerts-*"
              - "wazuh-archives-*"
            dls: '{"bool":{"should":[{"match":{"agent.groups":"DE"}},{"bool":{"must_not":{"exists":{"field":"agent.groups"}}}}]}}'
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - "wazuh-monitoring-*"
            dls: '{"bool":{"should":[{"match":{"group":"DE"}},{"bool":{"must_not":{"exists":{"field":"group"}}}}]}}'
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - "wazuh-statistics-*"
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - ".wazuh"
              - ".wazuh-version"
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - ".kibana*"
              - ".opensearch_dashboards*"
            allowed_actions:
              - "read"
              - "write"
              - "delete"
              - "manage"
              - "indices_all"
        tenant_permissions:
          - tenant_patterns:
              - "de_tenant"
            allowed_actions:
              - "kibana_all_write"

      wazuh_de_user:
        reserved: false
        cluster_permissions:
          - "cluster_monitor"
          - "cluster_composite_ops_ro"
          - "indices:data/read/scroll*"
        index_permissions:
          - index_patterns:
              - "wazuh-alerts-*"
              - "wazuh-archives-*"
            dls: '{"bool":{"should":[{"match":{"agent.groups":"DE"}},{"bool":{"must_not":{"exists":{"field":"agent.groups"}}}}]}}'
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - "wazuh-monitoring-*"
            dls: '{"bool":{"should":[{"match":{"group":"DE"}},{"bool":{"must_not":{"exists":{"field":"group"}}}}]}}'
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - "wazuh-statistics-*"
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - ".wazuh"
              - ".wazuh-version"
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - ".kibana*"
              - ".opensearch_dashboards*"
            allowed_actions:
              - "read"
              - "search"
              - "get"
        tenant_permissions:
          - tenant_patterns:
              - "de_tenant"
            allowed_actions:
              - "kibana_all_read"

      wazuh_ext_admin:
        reserved: false
        cluster_permissions:
          - "cluster_monitor"
          - "cluster_composite_ops"
          - "cluster:admin/opendistro/reports/*"
          - "cluster:admin/opendistro/alerting/*"
          - "indices:admin/template/*"
          - "indices:data/read/scroll*"
        index_permissions:
          - index_patterns:
              - "wazuh-alerts-*"
              - "wazuh-archives-*"
            dls: '{"bool":{"should":[{"match":{"agent.groups":"EXT"}},{"bool":{"must_not":{"exists":{"field":"agent.groups"}}}}]}}'
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - "wazuh-monitoring-*"
            dls: '{"bool":{"should":[{"match":{"group":"EXT"}},{"bool":{"must_not":{"exists":{"field":"group"}}}}]}}'
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - "wazuh-statistics-*"
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - ".wazuh"
              - ".wazuh-version"
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - ".kibana*"
              - ".opensearch_dashboards*"
            allowed_actions:
              - "read"
              - "write"
              - "delete"
              - "manage"
              - "indices_all"
        tenant_permissions:
          - tenant_patterns:
              - "ext_tenant"
            allowed_actions:
              - "kibana_all_write"

      wazuh_ext_user:
        reserved: false
        cluster_permissions:
          - "cluster_monitor"
          - "cluster_composite_ops_ro"
          - "indices:data/read/scroll*"
        index_permissions:
          - index_patterns:
              - "wazuh-alerts-*"
              - "wazuh-archives-*"
            dls: '{"bool":{"should":[{"match":{"agent.groups":"EXT"}},{"bool":{"must_not":{"exists":{"field":"agent.groups"}}}}]}}'
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - "wazuh-monitoring-*"
            dls: '{"bool":{"should":[{"match":{"group":"EXT"}},{"bool":{"must_not":{"exists":{"field":"group"}}}}]}}'
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - "wazuh-statistics-*"
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - ".wazuh"
              - ".wazuh-version"
            allowed_actions:
              - "read"
              - "search"
              - "get"
          - index_patterns:
              - ".kibana*"
              - ".opensearch_dashboards*"
            allowed_actions:
              - "read"
              - "search"
              - "get"
        tenant_permissions:
          - tenant_patterns:
              - "ext_tenant"
            allowed_actions:
              - "kibana_all_read"

    rolesMapping:
      wazuh_cm_admin:
        backend_roles:
          - "wazuh_cm_admin"
        users:
          - "cm_admin"

      wazuh_cm_user:
        backend_roles:
          - "wazuh_cm_user"
        users:
          - "cm_user"

      wazuh_de_admin:
        backend_roles:
          - "wazuh_de_admin"
        users:
          - "de_admin"

      wazuh_de_user:
        backend_roles:
          - "wazuh_de_user"
        users:
          - "de_user"

      wazuh_ext_admin:
        backend_roles:
          - "wazuh_ext_admin"
        users:
          - "ext_admin"

      wazuh_ext_user:
        backend_roles:
          - "wazuh_ext_user"
        users:
          - "ext_user"

  # Enable security admin job to apply the configuration
  securityAdmin:
    enabled: true
    maxRetries: 30
    retryInterval: 10

# Configure preferred tenants for the dashboard
dashboard:
  multiTenancy:
    preferredTenants:
      - "Global"
      - "cm_tenant"
      - "de_tenant"
      - "ext_tenant"
      - "Private"
