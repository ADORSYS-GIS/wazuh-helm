# templates/triggers/trigger-binding.yaml
# Enhanced trigger bindings for hybrid mode

# TriggerBinding for Master
apiVersion: triggers.tekton.dev/v1beta1
kind: TriggerBinding
metadata:
  name: wazuh-backup-master-binding
  namespace: {{ .Values.namespace }}
spec:
  params:
    - name: s3BucketName
      value: $(body.s3BucketName)
    - name: s3EndpointUrl
      value: $(body.s3EndpointUrl)
    - name: triggeredBy
      value: $(body.triggeredBy)

{{- if .Values.backup.components.indexer }}
---
# TriggerBinding for Indexer
apiVersion: triggers.tekton.dev/v1beta1
kind: TriggerBinding
metadata:
  name: wazuh-backup-indexer-binding
  namespace: {{ .Values.namespace }}
spec:
  params:
    - name: s3BucketName
      value: $(body.s3BucketName)
    - name: s3EndpointUrl
      value: $(body.s3EndpointUrl)
    - name: triggeredBy
      value: $(body.triggeredBy)
{{- end }}

{{- if .Values.backup.components.worker }}
---
# TriggerBinding for Worker
apiVersion: triggers.tekton.dev/v1beta1
kind: TriggerBinding
metadata:
  name: wazuh-backup-worker-binding
  namespace: {{ .Values.namespace }}
spec:
  params:
    - name: s3BucketName
      value: $(body.s3BucketName)
    - name: s3EndpointUrl
      value: $(body.s3EndpointUrl)
    - name: triggeredBy
      value: $(body.triggeredBy)
{{- end }}