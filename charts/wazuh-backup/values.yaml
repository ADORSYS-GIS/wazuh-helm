# values.yaml - Hybrid Mode Configuration

# ------------------------------------------------------------------------------
# Chart meta
# ------------------------------------------------------------------------------
namespace: wazuh
chartVersion: "0.1.0"

# ------------------------------------------------------------------------------
# Backup Configuration
# ------------------------------------------------------------------------------
backup:
  # Global backup settings
  schedule: "0 2 * * *"  # Default schedule for all components
  
  # Deployment mode
  mode:
    cronjobs: true    # Enable automatic scheduled backups
    triggers: true    # Enable HTTP-triggered backups
  
  s3:
    bucketName: "test-wazuh-backup-bucket"
    endpointUrl: ""  # Leave empty for AWS S3
    # S3 path will be: s3://bucket/DD-MM-YY-wazuh-backup/component-name/
    pathPrefix: "wazuh-backup"
  
  # Component-specific configurations
  components:
    master:
      enabled: true
      statefulsetName: "wazuh-wazuh-helm-manager-master"
      pvcName: "wazuh-wazuh-helm-manager-master-wazuh-wazuh-helm-manager-master-0"
      replicas: 1
      sourcePvcPath: ""
      backupSubdir: "master-backup"
      schedule: "0 2 * * *"  # Daily at 2 AM
    
    indexer:
      enabled: true
      statefulsetName: "wazuh-wazuh-helm-indexer"
      pvcName: "wazuh-wazuh-helm-indexer-wazuh-wazuh-helm-indexer-0"
      replicas: 2
      sourcePvcPath: ""
      backupSubdir: "indexer-backup"
      schedule: "0 3 * * *"  # Daily at 3 AM
    
    worker:
      enabled: true
      statefulsetName: "wazuh-wazuh-helm-manager-worker"
      pvcName: "wazuh-wazuh-helm-manager-worker-wazuh-wazuh-helm-manager-worker-0"
      replicas: 2
      sourcePvcPath: ""
      backupSubdir: "worker-backup"
      schedule: "0 4 * * *"  # Daily at 4 AM

# ------------------------------------------------------------------------------
# Tekton Task Images & Settings
# ------------------------------------------------------------------------------
tekton:
  tasks:
    cleanupPvc:
      image: "alpine:3.18"
    
    scaleStatefulset:
      image: "bitnami/kubectl:1.27"
    
    rsync:
      image: "eeacms/rsync:latest"
    
    s3Upload:
      image: "amazon/aws-cli:2.13.0"

# ------------------------------------------------------------------------------
# AWS Configuration
# ------------------------------------------------------------------------------
aws:
  region: eu-central-1
  secretName: aws-creds
  accessKeyId: ""
  secretAccessKey: ""
  sessionToken: ""

# ------------------------------------------------------------------------------
# RBAC Configuration
# ------------------------------------------------------------------------------
rbac:
  # Additional StatefulSets that the service account needs access to
  additionalStatefulSets:
    - "wazuh-wazuh-helm-indexer"
    - "wazuh-wazuh-helm-manager-worker"

# ------------------------------------------------------------------------------
# PVC Configuration
# ------------------------------------------------------------------------------
pvc:
  staging:
    name: "backup-staging-pvc"
    size: "20Gi"
    accessMode: "ReadWriteOnce"
    storageClass: "wazuh-wazuh-helm"

# ------------------------------------------------------------------------------
# Global defaults
# ------------------------------------------------------------------------------
global:
  imagePullPolicy: IfNotPresent